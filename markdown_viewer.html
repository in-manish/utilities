<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown Viewer</title>
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <script>
      tailwind.config = {
        darkMode: 'media', // or 'class'
        theme: {
          extend: {
            colors: {
                sky: {
                    50: '#f0f9ff', 100: '#e0f2fe', 200: '#bae6fd', 300: '#7dd3fc', 400: '#38bdf8',
                    500: '#0ea5e9', 600: '#0284c7', 700: '#0369a1', 800: '#075985', 900: '#0c4a6e'
                },
                amber: {
                    50: '#fffbeb', 100: '#fef3c7', 200: '#fde68a', 300: '#fcd34d', 400: '#fbbf24',
                    500: '#f59e0b', 600: '#d97706', 700: '#b45309', 800: '#92400e', 900: '#78350f'
                },
                emerald: {
                    50: '#ecfdf5', 100: '#d1fae5', 200: '#a7f3d0', 300: '#6ee7b7', 400: '#34d399',
                    500: '#10b981', 600: '#059669', 700: '#047857', 800: '#065f46', 900: '#064e3b'
                },
                violet: {
                    50: '#f5f3ff', 100: '#ede9fe', 200: '#ddd6fe', 300: '#c4b5fd', 400: '#a78bfa',
                    500: '#8b5cf6', 600: '#7c3aed', 700: '#6d28d9', 800: '#5b21b6', 900: '#4c1d95'
                },
                slate: { // Adding slate for body text and backgrounds
                    50: '#f8fafc', 100: '#f1f5f9', 200: '#e2e8f0', 300: '#cbd5e1', 400: '#94a3b8',
                    500: '#64748b', 600: '#475569', 700: '#334155', 800: '#1e293b', 900: '#0f172a'
                }
            },
            typography: ({ theme }) => ({
              DEFAULT: {
                css: {
                  '--tw-prose-body': theme('colors.slate[700]'),
                  '--tw-prose-headings': theme('colors.slate[800]'),
                  '--tw-prose-lead': theme('colors.slate[600]'),
                  '--tw-prose-links': theme('colors.sky[600]'),
                  '--tw-prose-bold': theme('colors.slate[800]'),
                  '--tw-prose-counters': theme('colors.slate[500]'),
                  '--tw-prose-bullets': theme('colors.sky[500]'),
                  '--tw-prose-hr': theme('colors.slate[300]'),
                  '--tw-prose-quotes': theme('colors.slate[600]'),
                  '--tw-prose-quote-borders': theme('colors.sky[300]'),
                  '--tw-prose-captions': theme('colors.slate[500]'),
                  '--tw-prose-code': theme('colors.emerald[700]'),
                  '--tw-prose-pre-code': theme('colors.emerald[700]'),
                  '--tw-prose-pre-bg': theme('colors.slate[100]'),
                  '--tw-prose-th-borders': theme('colors.slate[300]'),
                  '--tw-prose-td-borders': theme('colors.slate[200]'),
                  '--tw-prose-invert-body': theme('colors.slate[300]'),
                  '--tw-prose-invert-headings': theme('colors.white'),
                  '--tw-prose-invert-lead': theme('colors.slate[400]'),
                  '--tw-prose-invert-links': theme('colors.sky[400]'),
                  '--tw-prose-invert-bold': theme('colors.white'),
                  '--tw-prose-invert-counters': theme('colors.slate[400]'),
                  '--tw-prose-invert-bullets': theme('colors.sky[400]'),
                  '--tw-prose-invert-hr': theme('colors.slate[700]'),
                  '--tw-prose-invert-quotes': theme('colors.slate[300]'),
                  '--tw-prose-invert-quote-borders': theme('colors.sky[700]'),
                  '--tw-prose-invert-captions': theme('colors.slate[400]'),
                  '--tw-prose-invert-code': theme('colors.emerald[300]'),
                  '--tw-prose-invert-pre-code': theme('colors.emerald[300]'),
                  '--tw-prose-invert-pre-bg': theme('colors.slate[800]'),
                  '--tw-prose-invert-th-borders': theme('colors.slate[700]'),
                  '--tw-prose-invert-td-borders': theme('colors.slate[800]'),
                  // Customizations for specific elements
                  ul: {
                    paddingLeft: theme('spacing.5'), // Adjust list indentation
                  },
                  ol: {
                    paddingLeft: theme('spacing.5'),
                  },
                  'ul > li::marker': { // More specific bullet styling if needed
                    // color: theme('colors.sky[500]'), // Already handled by --tw-prose-bullets
                  },
                  pre: {
                    padding: theme('spacing.4'),
                    borderRadius: theme('borderRadius.lg'), // Slightly larger radius
                    boxShadow: theme('boxShadow.md'),
                  },
                  code: { // For inline code
                    fontWeight: '500',
                    padding: '0.2em 0.4em',
                    borderRadius: theme('borderRadius.sm'),
                  },
                  'code::before': { content: '"" !important' }, // Remove unwanted quotes around inline code
                  'code::after': { content: '"" !important' },
                  blockquote: {
                    fontWeight: '500',
                    fontStyle: 'italic',
                    paddingLeft: theme('spacing.4'),
                    borderLeftWidth: theme('borderWidth.4'),
                  },
                  '.mermaid': { // Ensure mermaid diagrams are centered and responsive
                    display: 'flex',
                    justifyContent: 'center',
                    margin: '1.5em auto', // More vertical margin
                    backgroundColor: theme('colors.white'), // Give mermaid a card-like bg
                    padding: theme('spacing.4'),
                    borderRadius: theme('borderRadius.md'),
                    boxShadow: theme('boxShadow.sm'),
                  },
                  '.mermaid svg': {
                    maxWidth: '100%',
                    height: 'auto',
                  },
                },
              },
              // Add dark mode prose styles if desired
              dark: { // This would be for prose-invert
                css: {
                    // --tw-prose-bullets will use --tw-prose-invert-bullets due to how prose works
                }
              }
            }),
          }
        }
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .prose code, #editor { /* Ensure editor also uses a nice mono font */
            font-family: 'Fira Code', monospace;
        }
        /* Custom scrollbar for webkit browsers - more subtle */
        textarea::-webkit-scrollbar, #preview::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        textarea::-webkit-scrollbar-track, #preview::-webkit-scrollbar-track {
            background: transparent; /* Make track invisible */
        }
        textarea::-webkit-scrollbar-thumb, #preview::-webkit-scrollbar-thumb {
            background: #cbd5e1; /* slate-300 */
            border-radius: 3px;
        }
        textarea::-webkit-scrollbar-thumb:hover, #preview::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; /* slate-400 */
        }
        /* Style for active button: uses a specific class now */
        .btn-mode-active {
            /* Example: using a darker shade of the button's original color and a ring */
            /* This will be complemented by JS adding specific color classes */
            /* box-shadow: 0 0 0 2px white, 0 0 0 4px theme('colors.sky.600'); */
            filter: brightness(0.85);
            transform: translateY(1px);
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 antialiased"> {/* Adjusted body bg for softer look */}
    <div class="container mx-auto p-3 sm:p-4 max-w-screen-2xl min-h-screen flex flex-col">
        <header class="mb-4 py-4">
            <h1 class="text-3xl sm:text-4xl font-bold text-center text-sky-700 select-none tracking-tight">Markdown Live Editor</h1>
            <p class="text-center text-slate-600 text-sm sm:text-base mt-1">Edit Markdown with live preview, including Mermaid diagrams.</p>
            <div id="controls-container" class="flex flex-wrap justify-center items-center gap-2 sm:gap-3 my-5 sm:my-6">
                <button id="btn-side-by-side" class="btn-mode bg-sky-500 hover:bg-sky-600 text-white font-medium py-2 px-4 rounded-lg text-sm sm:text-base transition-all duration-150 ease-in-out shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-400 focus:ring-opacity-75">Side-by-Side</button>
                <button id="btn-edit-only" class="btn-mode bg-sky-500 hover:bg-sky-600 text-white font-medium py-2 px-4 rounded-lg text-sm sm:text-base transition-all duration-150 ease-in-out shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-400 focus:ring-opacity-75">Editor Only</button>
                <button id="btn-view-only" class="btn-mode bg-sky-500 hover:bg-sky-600 text-white font-medium py-2 px-4 rounded-lg text-sm sm:text-base transition-all duration-150 ease-in-out shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-400 focus:ring-opacity-75">Preview Only</button>
                <button id="btn-copy" class="bg-emerald-500 hover:bg-emerald-600 text-white font-medium py-2 px-4 rounded-lg text-sm sm:text-base transition-all duration-150 ease-in-out shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-400 focus:ring-opacity-75">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-1 -mt-0.5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M8 2a1 1 0 000 2h2a1 1 0 100-2H8z" />
                        <path d="M3 5a2 2 0 012-2h6a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2V5zm8 0H5a1 1 0 00-1 1v6a1 1 0 001 1h6a1 1 0 001-1V6a1 1 0 00-1-1z" />
                    </svg>
                    Copy Markdown
                </button>
            </div>
        </header>

        <main id="main-content" class="flex flex-col sm:flex-row sm:gap-4 flex-grow" style="min-height: calc(100vh - 180px);"> {/* Adjusted min-height calc after header padding */}
            <div id="editor-container" class="w-full sm:w-1/2 h-1/2 sm:h-full p-1 bg-white rounded-xl shadow-2xl border border-slate-200 flex flex-col overflow-hidden">
                <textarea id="editor" class="w-full h-full flex-grow p-3 sm:p-4 rounded-lg focus:outline-none resize-none text-base leading-relaxed bg-transparent" placeholder="Enter Markdown here..."></textarea>
            </div>
            <div id="preview-container" class="w-full sm:w-1/2 h-1/2 sm:h-full p-1 mt-3 sm:mt-0 bg-white rounded-xl shadow-2xl border border-slate-200 flex flex-col overflow-hidden">
                <div id="preview" class="w-full h-full flex-grow p-4 sm:p-5 rounded-lg overflow-y-auto prose prose-sm sm:prose-base lg:prose-lg xl:prose-xl max-w-none prose-sky dark:prose-invert">
                </div>
            </div>
        </div>
    </div>

    <script>
        const editor = document.getElementById('editor');
        const preview = document.getElementById('preview');
        const editorContainer = document.getElementById('editor-container');
        const previewContainer = document.getElementById('preview-container');
        const mainContent = document.getElementById('main-content');

        const btnSideBySide = document.getElementById('btn-side-by-side');
        const btnEditOnly = document.getElementById('btn-edit-only');
        const btnViewOnly = document.getElementById('btn-view-only');
        const btnCopy = document.getElementById('btn-copy');

        // Initialize Mermaid
        mermaid.initialize({ startOnLoad: false });

        // Function to render markdown
        async function renderMarkdown() {
            const markdownText = editor.value;
            preview.innerHTML = marked.parse(markdownText);

            // Process Mermaid diagrams
            const mermaidElements = preview.querySelectorAll('.language-mermaid');
            for (let i = 0; i < mermaidElements.length; i++) {
                const element = mermaidElements[i];
                const mermaidCode = element.textContent;
                try {
                    const { svg } = await mermaid.render(`mermaid-graph-${i}`, mermaidCode);
                    const div = document.createElement('div');
                    div.className = 'mermaid'; // Add class for styling via Tailwind prose or custom CSS
                    div.innerHTML = svg;
                    element.parentNode.replaceWith(div);
                } catch (e) {
                    console.error("Mermaid rendering error:", e);
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'text-red-500 font-bold';
                    errorDiv.textContent = 'Error rendering Mermaid diagram.';
                    element.parentNode.replaceWith(errorDiv);
                }
            }
        }

        // Event listener for editor input
        editor.addEventListener('input', renderMarkdown);

        const allModeButtons = document.querySelectorAll('.btn-mode');

        function setActiveButton(activeBtn) {
            allModeButtons.forEach(btn => {
                btn.classList.remove('btn-mode-active');
                btn.classList.remove('ring-sky-600', 'ring-2', 'ring-offset-2'); // Clear specific ring if any
            });
            activeBtn.classList.add('btn-mode-active');
            activeBtn.classList.add('ring-sky-600', 'ring-2', 'ring-offset-2'); // Add a consistent ring to active
        }

        // Event listeners for view mode buttons
        btnSideBySide.addEventListener('click', () => {
            editorContainer.classList.remove('hidden');
            previewContainer.classList.remove('hidden');

            editorContainer.classList.replace('sm:w-full', 'sm:w-1/2');
            editorContainer.classList.replace('w-full', 'sm:w-1/2'); // Ensure sm:w-1/2 takes precedence
            editorContainer.classList.add('w-full', 'h-1/2', 'sm:h-full');


            previewContainer.classList.replace('sm:w-full', 'sm:w-1/2');
            previewContainer.classList.replace('w-full', 'sm:w-1/2'); // Ensure sm:w-1/2 takes precedence
            previewContainer.classList.add('w-full', 'h-1/2', 'sm:h-full');

            mainContent.classList.remove('sm:flex-col'); // if it was set by other modes
            mainContent.classList.add('flex-col', 'sm:flex-row');

            setActiveButton(btnSideBySide);
            renderMarkdown();
        });

        btnEditOnly.addEventListener('click', () => {
            editorContainer.classList.remove('hidden', 'sm:w-1/2', 'h-1/2');
            editorContainer.classList.add('w-full', 'h-full');
            previewContainer.classList.add('hidden');

            mainContent.classList.remove('sm:flex-row');
            mainContent.classList.add('flex-col');

            setActiveButton(btnEditOnly);
        });

        btnViewOnly.addEventListener('click', () => {
            previewContainer.classList.remove('hidden', 'sm:w-1/2', 'h-1/2');
            previewContainer.classList.add('w-full', 'h-full');
            editorContainer.classList.add('hidden');

            mainContent.classList.remove('sm:flex-row');
            mainContent.classList.add('flex-col');

            setActiveButton(btnViewOnly);
            renderMarkdown();
        });

        // Event listener for copy button
        btnCopy.addEventListener('click', () => {
            if (navigator.clipboard && window.isSecureContext) { // Modern async clipboard API
                navigator.clipboard.writeText(editor.value)
                    .then(() => {
                        btnCopy.textContent = 'Copied!';
                        btnCopy.classList.add('bg-teal-500', 'hover:bg-teal-600');
                        btnCopy.classList.remove('bg-amber-500', 'hover:bg-amber-600');
                        setTimeout(() => {
                            btnCopy.textContent = 'Copy Markdown';
                            btnCopy.classList.remove('bg-teal-500', 'hover:bg-teal-600');
                            btnCopy.classList.add('bg-amber-500', 'hover:bg-amber-600');
                        }, 2000);
                    })
                    .catch(err => {
                        console.error('Failed to copy text: ', err);
                        alert('Failed to copy text. See console for details.');
                    });
            } else { // Fallback for older browsers or insecure contexts
                editor.select();
                try {
                    document.execCommand('copy');
                    btnCopy.textContent = 'Copied! (fallback)';
                     btnCopy.classList.add('bg-teal-500', 'hover:bg-teal-600');
                    btnCopy.classList.remove('bg-amber-500', 'hover:bg-amber-600');
                    setTimeout(() => {
                        btnCopy.textContent = 'Copy Markdown';
                        btnCopy.classList.remove('bg-teal-500', 'hover:bg-teal-600');
                        btnCopy.classList.add('bg-amber-500', 'hover:bg-amber-600');
                    }, 2000);
                } catch (err) {
                    console.error('Fallback copy failed: ', err);
                    alert('Failed to copy text using fallback. See console.');
                }
                window.getSelection().removeAllRanges(); // Deselect
            }
        });

        // Initial content
        editor.value = `# Welcome to Markdown Editor!

This is a simple Markdown editor with a live preview. It supports standard Markdown and Mermaid diagrams.

## Features
- Side-by-side editing and preview
- Editor only mode
- Preview only mode
- Copy Markdown to clipboard
- Mermaid diagram support

## Example Markdown
Here's some **bold text** and *italic text*.

### Lists
1. First item
2. Second item
   - Sub-item A
   - Sub-item B

### Code Block
\`\`\`javascript
function greet(name) {
  console.log(\`Hello, \${name}!\`);
}
greet('World');
\`\`\`

### Mermaid Diagram Example
\`\`\`mermaid
graph TD
    A[Start] --> B{Is it?};
    B -- Yes --> C[OK];
    C --> D[End];
    B -- No --> E[Really?];
    E --> D[End];
\`\`\`

Try editing this text or pasting your own Markdown!
`;
        // Initial render
        renderMarkdown();
        // Default to side-by-side on load for larger screens
        if (window.innerWidth >= 640) { // sm breakpoint in Tailwind
             btnSideBySide.click();
        } else { // On smaller screens, default to editor only or handle differently
            // For mobile, let's default to stacked side-by-side initially
            editorContainer.classList.remove('hidden', 'sm:w-full');
            previewContainer.classList.remove('hidden', 'sm:w-full');
            editorContainer.classList.add('w-full', 'h-1/2'); // Full width, half height
            previewContainer.classList.add('w-full', 'h-1/2'); // Full width, half height
            mainContent.classList.add('flex-col'); // Stack them vertically
        }

    </script>
</body>
</html>
